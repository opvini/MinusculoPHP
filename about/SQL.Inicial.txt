
CREATE DATABASE `mvc` DEFAULT CHARACTER SET utf8;
USE mvc;


CREATE TABLE `modulo` (
  `Id` int(11) NOT NULL AUTO_INCREMENT,
  `descricao` varchar(50) DEFAULT NULL,
  `permissao_default` int(1) DEFAULT '1',
  PRIMARY KEY (`Id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;



CREATE TABLE `user_tipo` (
  `Id` int(11) NOT NULL AUTO_INCREMENT,
  `descricao` varchar(50) DEFAULT NULL,
  PRIMARY KEY (`Id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;




CREATE TABLE `user_permissao` (
  `Id` int(11) NOT NULL AUTO_INCREMENT,
  `fgk_tipo_user` int(11) DEFAULT NULL,
  `fgk_modulo` int(11) DEFAULT NULL,
  `permissao` int(1) DEFAULT '0',
  `fgk_user_registro` int(11) DEFAULT NULL,
  `data_registro` datetime DEFAULT NULL,
  PRIMARY KEY (`Id`),
  KEY `fgk_modulo` (`fgk_modulo`),
  KEY `fgk_user_registro` (`fgk_user_registro`),
  KEY `user_permissao_ibfk_1` (`fgk_tipo_user`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;



CREATE TABLE `pessoa_fisica` (
  `Id` int(11) NOT NULL AUTO_INCREMENT,
  `nome` varchar(50) DEFAULT NULL,
  `endereco` varchar(50) DEFAULT NULL,
  `numero_endereco` varchar(10) DEFAULT NULL,
  `cpf` varchar(20) DEFAULT NULL,
  `rg` varchar(20) DEFAULT NULL,
  `email` varchar(100) DEFAULT NULL,
  `fgk_user_registro` int(11) DEFAULT NULL,
  `bool_excluido` bit(1) DEFAULT b'0',
  `data` datetime DEFAULT NULL,
  PRIMARY KEY (`Id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;



CREATE TABLE `usuario` (
  `Id` int(11) NOT NULL AUTO_INCREMENT,
  `fgk_pessoa` int(11) DEFAULT '0',
  `usuario` varchar(20) DEFAULT NULL,
  `senha` varchar(50) DEFAULT NULL,
  `fgk_tipo` int(2) DEFAULT NULL,
  `session_id` varchar(100) DEFAULT NULL,
  `fgk_user_registro` int(11) DEFAULT NULL,
  `data_registro` datetime DEFAULT NULL,
  `bool_excluido` bit(1) DEFAULT b'0',
  PRIMARY KEY (`Id`),
  KEY `fgk_tipo` (`fgk_tipo`),
  KEY `fgk_user_registro` (`fgk_user_registro`),
  KEY `fgk_pessoa` (`fgk_pessoa`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;



CREATE TABLE `token` (
  `Id` int(11) NOT NULL AUTO_INCREMENT,
  `token` varchar(255) DEFAULT NULL,
  `expires` datetime DEFAULT NULL,
  `fgk_user` int(11) DEFAULT NULL,
  `bool_excluido` bit(1) DEFAULT b'0',
  PRIMARY KEY (`Id`),
  KEY `fgk_user` (`fgk_user`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;


ALTER TABLE `mvc`.`pessoa_fisica`
  ADD FOREIGN KEY (`fgk_user_registro`) REFERENCES `mvc`.`usuario` (`Id`) ON DELETE NO ACTION ON UPDATE NO ACTION;
SHOW CREATE TABLE `mvc`.`pessoa_fisica`;

ALTER TABLE `mvc`.`token`
  ADD FOREIGN KEY (`fgk_user`) REFERENCES `mvc`.`usuario` (`Id`) ON DELETE NO ACTION ON UPDATE NO ACTION;
SHOW CREATE TABLE `mvc`.`token`;

ALTER TABLE `mvc`.`user_permissao`
  ADD FOREIGN KEY (`fgk_tipo_user`) REFERENCES `mvc`.`user_tipo` (`Id`) ON DELETE NO ACTION ON UPDATE NO ACTION;
SHOW CREATE TABLE `mvc`.`user_permissao`;

ALTER TABLE `mvc`.`user_permissao`
  ADD FOREIGN KEY (`fgk_user_registro`) REFERENCES `mvc`.`usuario` (`Id`) ON DELETE NO ACTION ON UPDATE NO ACTION;
SHOW CREATE TABLE `mvc`.`user_permissao`;

ALTER TABLE `mvc`.`usuario`
  ADD FOREIGN KEY (`fgk_pessoa`) REFERENCES `mvc`.`pessoa_fisica` (`Id`) ON DELETE NO ACTION ON UPDATE NO ACTION;
SHOW CREATE TABLE `mvc`.`usuario`;

ALTER TABLE `mvc`.`usuario`
  ADD FOREIGN KEY (`fgk_tipo`) REFERENCES `mvc`.`user_tipo` (`Id`) ON DELETE NO ACTION ON UPDATE NO ACTION;
SHOW CREATE TABLE `mvc`.`usuario`;

ALTER TABLE `mvc`.`usuario`
  ADD FOREIGN KEY (`fgk_user_registro`) REFERENCES `mvc`.`usuario` (`Id`) ON DELETE NO ACTION ON UPDATE NO ACTION;
SHOW CREATE TABLE `mvc`.`usuario`;


INSERT INTO `user_tipo` VALUES (1,'admin');
INSERT INTO `user_tipo` VALUES (2,'super usuario');
INSERT INTO `user_tipo` VALUES (3,'usuario');
INSERT INTO `user_tipo` VALUES (4,'leitor');
INSERT INTO `user_tipo` VALUES (5,'publico');


